(()=>{"use strict";const t="section-hidden",e="section-visible",i="section-transition";function s(s){s.classList.contains(e)&&s.classList.remove(e),s.classList.contains(t)&&s.classList.remove(t),s.classList.add(i)}function a(a,n){a.addEventListener("transitionend",(function o(r){var l;"transform"===r.propertyName&&(a.removeEventListener("transitionend",o,!1),(l=a).classList.contains(e)&&l.classList.remove(e),l.classList.contains(i)&&l.classList.remove(i),l.classList.add(t),s(n),setTimeout((()=>{!function(s){s.classList.contains(i)&&s.classList.remove(i),s.classList.contains(t)&&s.classList.remove(t),s.classList.add(e)}(n)}),0))}),!1),s(a)}const n={ru:{artists:"Художники",artistsQuestion:"Кто автор этой картины?",pictures:"Картины",picturesQuestion:"Какую из этих картин написал {author}?",loadError:"Не удалось загрузить вопросы: ошибка ",loading:"Загрузка...",gui:{".menu__artist .menu__title span":"Художники",".menu__picture .menu__title span":"Картины",".main__settings span":"Настройки",".settings__title span":"Настройки",".settings__item-volume .settings__item-text":"Громкость",".settings__item-time .settings__item-text":"Время",".settings__item-lang .settings__item-text":"Язык",".settings__back":"Назад",".settings__default":"По умолчанию",".catalog__home":"На главную",".catalog__reset":"Сбросить",".catalog_result":"Результат",".quiz__back":"Назад",".quiz__time-title":"Время: ",".result__title-category":"Категория ",".answer__next":"Далее",".congratulation__title span":"Молодец!"}},en:{artists:"Artists",artistsQuestion:"Who is author of this picture?",pictures:"Paintings",picturesQuestion:"Which of these pictures did he write {author}?",loadError:"Failed to load questions: error {error}",loading:"Loading...",gui:{".menu__artist .menu__title span":"Artists",".menu__picture .menu__title span":"Paintings",".main__settings span":"Settings",".settings__title span":"Settings",".settings__item-volume .settings__item-text":"Volume",".settings__item-time .settings__item-text":"Time",".settings__item-lang .settings__item-text":"Language",".settings__back":"Back",".settings__default":"Default",".catalog__home":"To main",".catalog__reset":"Reset",".catalog_result":"Result",".quiz__back":"Back",".quiz__time-title":"Time: ",".result__title-category":"Category ",".answer__next":"Next",".congratulation__title span":"Well done!"}}};new class{constructor(){this.images=[],this.settingsDefault={volume:0,time:0,lang:"ru"},this.SETTINGS_VOLUME=document.querySelector(".settings__item-volume-value"),this.SETTINGS_TIME=document.querySelector(".settings__item-time-value"),this.SETTINGS_LANG=document.querySelector(".settings__item-lang-value"),this.quiz={completed:[1,2,3,8,9,23,55,199,100,120,121,130]},this.settingsDefaultSet(),this.artistIndex=10,this.pictureIndex=130,this.answerIndex=0,this.answerValue=null,this.answers=[],this.time=0,this.timerId=null,this.isWaitKey=!1,window.addEventListener("beforeunload",this.setLocalStorage.bind(this)),window.addEventListener("load",this.getLocalStorage.bind(this)),this.MAIN=document.querySelector(".main"),this.MAIN_ARTIST=document.querySelector(".menu__artist"),this.MAIN_PICTURE=document.querySelector(".menu__picture"),this.MAIN_SETTINGS=document.querySelector(".main__settings"),this.SETTINGS=document.querySelector(".settings"),this.SETTINGS_BACK=document.querySelector(".settings__back"),this.SETTINGS_DEFAULT=document.querySelector(".settings__default"),this.SETTINGS_ICO_VOLUME=document.querySelector(".settings__item-volume-ico"),this.SETTINGS_ICO_TIME=document.querySelector(".settings__item-time-ico"),this.SETTINGS_ICO_LANG=document.querySelector(".settings__item-lang-ico"),this.CATALOG=document.querySelector(".catalog"),this.CATALOG_HOME=document.querySelector(".catalog__home"),this.CATALOG_RESULTS=document.querySelectorAll(".catalog_result"),this.CATALOG_RESET=document.querySelector(".catalog__reset"),this.CATALOG_ITEMS=this.CATALOG.querySelectorAll(".catalog__item"),this.QUIZ=document.querySelector(".quiz"),this.QUIZ_ITEMS=document.querySelector(".quiz__items"),this.QUIZ_PICTURES=document.querySelector(".quiz__pictures"),this.QUIZ_BULLETS=document.querySelectorAll(".quiz__bullet"),this.QUIZ_QUESTION=document.querySelector(".quiz__question span"),this.QUIZ_BACK=document.querySelector(".quiz__back"),this.QUIZ_TIME_LOST=document.querySelector(".quiz__time-lost"),this.RESULT=document.querySelector(".result"),this.RESULT_ITEMS=document.querySelectorAll(".result__item"),this.RESULT_SCOPE=document.querySelector(".result__scope"),this.RESULT_TITLE_NUMBER=document.querySelector(".result__title-number"),this.RESULT_BACK=document.querySelector(".result__back"),this.ANSWER=document.querySelector(".answer"),this.ANSWER_PIC=this.ANSWER.querySelector(".answer__pic"),this.ANSWER_NAME=this.ANSWER.querySelector(".answer__name"),this.ANSWER_AUTHOR=this.ANSWER.querySelector(".answer__author"),this.ANSWER_YEAR=this.ANSWER.querySelector(".answer__year"),this.ANSWER_NEXT=document.querySelector(".answer__next"),this.CONGRATUATION=document.querySelector(".congratulation"),this.CONGRATUATION_RESULT=document.querySelector(".congratulation__result .congratulation_text"),this.CONGRATUATION_BTN=document.querySelector(".congratulation__btn"),this.loadImages(),this.MAIN_SETTINGS.addEventListener("click",this.toggleMainSettings.bind(this)),this.SETTINGS_BACK.addEventListener("click",this.toggleSettingsMain.bind(this)),this.SETTINGS_DEFAULT.addEventListener("click",this.settingsDefaultSet.bind(this)),this.SETTINGS_VOLUME.addEventListener("change",this.settingsVolumeSet.bind(this)),this.SETTINGS_TIME.addEventListener("change",this.settingsTimeSet.bind(this)),this.SETTINGS_LANG.addEventListener("change",this.settingsLangSet.bind(this)),this.SETTINGS_ICO_VOLUME.addEventListener("click",this.toggleVolume.bind(this)),this.SETTINGS_ICO_TIME.addEventListener("click",this.toggleTime.bind(this)),this.SETTINGS_ICO_LANG.addEventListener("click",this.toogleLang.bind(this)),this.QUIZ_BACK.addEventListener("click",this.toogleQuizCatalog.bind(this)),this.CATALOG_HOME.addEventListener("click",this.toggleCatalogMain.bind(this)),[...this.CATALOG_RESULTS].forEach((t=>{t.addEventListener("click",this.toggleCatalogResult.bind(this))})),this.CATALOG_RESET.addEventListener("click",this.resetCatalog.bind(this)),[...this.CATALOG_ITEMS].forEach((t=>{t.addEventListener("click",this.toogleCatalogQuiz.bind(this))})),[...this.RESULT_ITEMS].forEach((t=>{t.addEventListener("click",this.aboutShow.bind(this))})),this.RESULT_BACK.addEventListener("click",this.toggleResultCatalog.bind(this)),this.ANSWER_NEXT.addEventListener("click",this.answerHide.bind(this)),this.CONGRATUATION_BTN.addEventListener("click",this.quizEnd.bind(this)),document.addEventListener("keydown",this.keyDown.bind(this))}async loadImages(){let t=await fetch("./assets/json/images.json");t.ok?(this.images=await t.json(),this.MAIN_ARTIST.addEventListener("click",this.toggleMainCatalog.bind(this,this.artistIndex)),this.MAIN_PICTURE.addEventListener("click",this.toggleMainCatalog.bind(this,this.pictureIndex))):alert(n[this.quiz.lang].loadError.replace("{error}",t.status))}keyDown(t){if(this.isWaitKey&&["1","2","3","4"].includes(t.key)){this.timerStop();let e=this.catalogStartIndex();this.toogleAnswer(this.answerValue==[...document.querySelectorAll(this.isArtist(e)?".quiz__item":".quiz__picture-pictures")][Number(t.key)-1].dataset.answer,Number(this.QUIZ.dataset.picNumber),!0),this.ANSWER.classList.add("popup-visible"),this.ANSWER.classList.remove("popup-hidden")}}setLocalStorage(){localStorage.setItem("quiz",JSON.stringify(this.quiz))}getLocalStorage(){"ru"!=this.quiz.lang&&this.translateApp()}toggleMainSettings(){a(this.MAIN,this.SETTINGS)}toggleSettingsMain(){a(this.SETTINGS,this.MAIN)}settingsSet(){this.SETTINGS_VOLUME.value=this.quiz.volume,this.SETTINGS_TIME.value=this.quiz.time,this.SETTINGS_LANG.value=this.quiz.lang}settingsDefaultSet(){[this.quiz.volume,this.quiz.time,this.quiz.lang]=Object.values(this.settingsDefault),this.settingsSet(),this.translateApp()}settingsVolumeSet(){this.quiz.volume=Number(this.SETTINGS_VOLUME.value)}settingsTimeSet(){this.quiz.time=Number(this.SETTINGS_TIME.value)}settingsLangSet(){this.quiz.lang=this.SETTINGS_LANG.value,this.translateApp()}toggleVolume(){this.SETTINGS_VOLUME.value=0==this.SETTINGS_VOLUME.value?.5:0,this.settingsVolumeSet()}toggleTime(){this.SETTINGS_TIME.value=0==this.SETTINGS_TIME.value?30:0,this.settingsTimeSet()}toogleLang(){this.SETTINGS_LANG.value="ru"==this.SETTINGS_LANG.value?"en":"ru",this.settingsLangSet()}translateApp(){for(const[t,e]of Object.entries(n[this.quiz.lang].gui))[...document.querySelectorAll(t)].forEach((t=>{t.textContent=e}))}shuffleAnswer(t,e){const i=[t];for(;i.length<4;){const t=this.images.filter((t=>!i.includes(t[e])));i.push(t[this.getRandomInt(0,t.length)][e])}return i.sort((()=>Math.random()-.5))}getRandomInt(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t))+t}clearNode(t){for(;t.firstChild;)t.removeChild(t.firstChild)}timerStop(){this.timerId=null}toogleQuizCatalog(){this.timerStop(),this.isWaitKey=!1,a(this.QUIZ,this.CATALOG)}async quizUpdate(t){this.timeSet("--"),this.QUIZ.dataset.picNumber=t,this.clearNode(this.QUIZ_PICTURES),this.clearNode(this.QUIZ_ITEMS);const e=this.images.filter((e=>e.imageNum==t))[0];if(this.isArtist(t)){const i="author";this.answerValue=e[i];const s=this.shuffleAnswer(this.answerValue,i);this.QUIZ_QUESTION.textContent=n[this.quiz.lang].artistsQuestion,this.QUIZ_PICTURES.className="quiz__pictures";const a=document.createElement("div");a.className="quiz__picture quiz__picture-artists",a.textContent=n[this.quiz.lang].loading,this.QUIZ_PICTURES.append(a),a.style.backgroundImage=await this.loadBackgroundImage(`./assets/img/${t}.jpg`),a.textContent="";for(let t=0;t<4;t++){const e=document.createElement("div");e.className="quiz__item",e.dataset.answer=s[t],e.textContent=`${t+1}. ${e.dataset.answer}`,e.addEventListener("click",this.answerShow.bind(this)),this.QUIZ_ITEMS.append(e)}}else{const t="imageNum";this.answerValue=e[t];const i=this.shuffleAnswer(this.answerValue,t);this.QUIZ_QUESTION.textContent=n[this.quiz.lang].picturesQuestion.replace("{author}",e.author),this.QUIZ_PICTURES.className="quiz__pictures quiz_pictures-grid";for(let t=0;t<4;t++){const e=document.createElement("div");e.className="quiz__picture quiz__picture-pictures",e.dataset.answer=i[t],e.textContent=n[this.quiz.lang].loading,e.dataset.tooltip=t+1,this.QUIZ_PICTURES.append(e)}const s=[];for(let t=0;t<4;t++)s.push(await this.loadBackgroundImage(`./assets/img/${i[t]}.jpg`)),this.QUIZ_PICTURES.children[t].textContent="";for(let t=0;t<4;t++){const e=this.QUIZ_PICTURES.children[t];e.style.backgroundImage=s[t],e.addEventListener("click",this.answerShow.bind(this))}}this.isWaitKey=!0,this.quiz.time>0?(this.time=this.quiz.time,this.timeSet(this.time),this.timerId=setTimeout(this.quizTick.bind(this),1500)):this.timerStop()}timeSet(t){this.QUIZ_TIME_LOST.textContent=t}quizTick(){this.timerId&&(this.time--,this.timeSet(this.time),this.time>0?this.timerId=setTimeout(this.quizTick.bind(this),1e3):(this.timerId=null,this.toogleAnswer(!1,Number(this.QUIZ.dataset.picNumber),!0),this.ANSWER.classList.add("popup-visible"),this.ANSWER.classList.remove("popup-hidden")))}toogleCatalogQuiz(t){let e=this.catalogPicNumber(t);this.quizUpdate(e),Array.from(this.QUIZ_BULLETS).forEach((t=>{t.classList.contains("quiz__bullet-right")&&t.classList.remove("quiz__bullet-right"),t.classList.contains("quiz__bullet-wrong")&&t.classList.remove("quiz__bullet-wrong")})),this.answerIndex=0,this.answers=[],a(this.CATALOG,this.QUIZ)}updateCatalog(t,e=!1){Array.from(this.CATALOG_ITEMS).forEach((i=>{const s=this.quiz.completed.filter((e=>e>=t-9&&e<=t));i.dataset.complete=s.length;const a=i.querySelector(".catalog__item-scope");s.length?a.textContent=s.length+"/10":a.textContent="",e&&(i.querySelector(".catalog__item-pic").style.backgroundImage=`url('./assets/img/${t}.jpg')`),t+=10}))}toggleMainCatalog(t){this.CATALOG.querySelector(".catalog__title span").textContent=this.isArtist(t)?n[this.quiz.lang].artists:n[this.quiz.lang].pictures,this.updateCatalog(t,!0),this.CATALOG.dataset.startIndex=t,a(this.MAIN,this.CATALOG)}catalogStartIndex(){return Number(this.CATALOG.dataset.startIndex)}catalogPicNumber(t){let e=this.catalogStartIndex();const i=t.target.parentNode;let s=[...i.parentNode.children].indexOf(i);return this.RESULT_TITLE_NUMBER.textContent=i.querySelector(".catalog__item-title").textContent,this.RESULT_SCOPE.textContent=i.querySelector(".catalog__item-scope").textContent,e-10+10*s+1}isArtist(t){return t<=this.pictureIndex-10}resetCatalog(){let t=this.catalogStartIndex();this.isArtist(t)?this.quiz.completed=this.quiz.completed.filter((t=>t>this.pictureIndex-10)):this.quiz.completed=this.quiz.completed.filter((t=>t<=this.pictureIndex-10)),this.updateCatalog(t)}toggleCatalogMain(){a(this.CATALOG,this.MAIN)}toggleCatalogResult(t){t.stopPropagation();let e=this.catalogPicNumber(t);Array.from(this.RESULT_ITEMS).forEach((t=>{const i=this.quiz.completed.includes(e);t.dataset.complete=i?1:0,t.dataset.picNumber=e,t.querySelector(".result__item-pic").style.backgroundImage=`url('./assets/img/${e}.jpg')`,e++})),a(this.CATALOG,this.RESULT)}toggleResultCatalog(){a(this.RESULT,this.CATALOG)}toogleAnswer(t,e,i){this.isWaitKey=!1,this.ANSWER.dataset.complete=t,"boolean"==typeof t&&this.audioPlay(t?audioRight:audioWrong),this.ANSWER_PIC.style.backgroundImage=`url('./assets/img/${e}.jpg')`;const s=this.images.filter((t=>t.imageNum==e));s.length&&(this.ANSWER_NAME.textContent=s[0].name,this.ANSWER_AUTHOR.textContent=s[0].author,this.ANSWER_YEAR.textContent=s[0].year,this.ANSWER.dataset.isAnswer=i,this.ANSWER.classList.add("popup-visible"),this.ANSWER.classList.remove("popup-hidden"))}answerShow(t){this.timerStop(),this.toogleAnswer(this.answerValue==t.target.dataset.answer,Number(this.QUIZ.dataset.picNumber),!0),this.ANSWER.classList.add("popup-visible"),this.ANSWER.classList.remove("popup-hidden")}aboutShow(t){const e=t.currentTarget,i=e.dataset.complete,s=e.dataset.picNumber;this.toogleAnswer(i,s,!1)}answerHide(){if(this.ANSWER.classList.add("popup-hidden"),this.ANSWER.classList.remove("popup-visible"),"true"==this.ANSWER.dataset.isAnswer){const t="true"===this.ANSWER.dataset.complete;let e,i=Number(this.QUIZ.dataset.picNumber);t?(e="quiz__bullet-right",this.answers.push(i)):e="quiz__bullet-wrong",this.QUIZ_BULLETS[this.answerIndex].classList.add(e),this.answerIndex++,10==this.answerIndex?(this.CONGRATUATION_RESULT.textContent=this.answers.length+"/10",this.quiz.completed=[...new Set([...this.quiz.completed,...this.answers])],this.CONGRATUATION.classList.add("popup-visible"),this.CONGRATUATION.classList.remove("popup-hidden"),this.audioPlay(audioEndRound)):this.quizUpdate(++i)}}audioPlay(t){Number(this.SETTINGS_VOLUME.value)>0&&t.play()}quizEnd(){const t=Number(this.CATALOG.dataset.startIndex);this.updateCatalog(t),this.CONGRATUATION.classList.add("popup-hidden"),this.CONGRATUATION.classList.remove("popup-visible"),a(this.QUIZ,this.CATALOG)}loadBackgroundImage(t){return new Promise(((e,i)=>{let s=new Image;s.src=t,s.onload=()=>{e(`url(${t})`)},s.onerror=()=>{i()}}))}}})();