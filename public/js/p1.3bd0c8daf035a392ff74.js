(()=>{"use strict";const t="section-hidden",e="section-visible",i="section-transition";function s(s){s.classList.contains(e)&&s.classList.remove(e),s.classList.contains(t)&&s.classList.remove(t),s.classList.add(i)}function n(n,a){n.addEventListener("transitionend",(function o(r){var l;"transform"===r.propertyName&&(n.removeEventListener("transitionend",o,!1),(l=n).classList.contains(e)&&l.classList.remove(e),l.classList.contains(i)&&l.classList.remove(i),l.classList.add(t),s(a),setTimeout((()=>{!function(s){s.classList.contains(i)&&s.classList.remove(i),s.classList.contains(t)&&s.classList.remove(t),s.classList.add(e)}(a)}),0))}),!1),s(n)}const a={ru:{artists:"Художники",artistsQuestion:"Кто автор этой картины?",pictures:"Картины",picturesQuestion:"Какую из этих картин написал {author}?",loadError:"Не удалось загрузить вопросы: ошибка ",loading:"Загрузка...",username:"Кто ты?",gui:{".menu__artist .menu__title span":"Художники",".menu__picture .menu__title span":"Картины",".main__settings span":"Настройки",".main__top10":"ТОП 10",".settings__title span":"Настройки",".settings__item-volume .settings__item-text":"Громкость",".settings__item-time .settings__item-text":"Время",".settings__item-lang .settings__item-text":"Язык",".settings__back":"Назад",".settings__default":"По умолчанию",".catalog__home":"На главную",".catalog__reset":"Сбросить",".catalog_result":"Результат",".quiz__back":"Назад",".quiz__time-title":"Время: ",".result__title-category":"Категория ",".answer__next":"Далее",".congratulation__title span":"Молодец!",".congratulation__info-title":"Поделись результатом: ",".congratulation__send":"Поделиться",".top10__back":"Назад",".top10__title span":"ТОП 10",".top10__cell-header-num span":"№",".top10__cell-header-username span":"Имя",".top10__cell-header-total span":"Счет"}},en:{artists:"Artists",artistsQuestion:"Who is author of this picture?",pictures:"Paintings",picturesQuestion:"Which of these pictures did he write {author}?",loadError:"Failed to load questions: error {error}",loading:"Loading...",username:"Who are you?",gui:{".menu__artist .menu__title span":"Artists",".menu__picture .menu__title span":"Paintings",".main__settings span":"Settings",".main__top10":"TOP 10",".settings__title span":"Settings",".settings__item-volume .settings__item-text":"Volume",".settings__item-time .settings__item-text":"Time",".settings__item-lang .settings__item-text":"Language",".settings__back":"Back",".settings__default":"Default",".catalog__home":"To main",".catalog__reset":"Reset",".catalog_result":"Result",".quiz__back":"Back",".quiz__time-title":"Time: ",".result__title-category":"Category ",".answer__next":"Next",".congratulation__title span":"Well done!",".congratulation__info-title":"Share result: ",".congratulation__send":"Share",".top10__back":"Back",".top10__title span":"TOP 10",".top10__cell-header-num span":"#",".top10__cell-header-username span":"Name",".top10__cell-header-total span":"Score"}}};new class{constructor(){this.images=[],this.settingsDefault={volume:.5,time:30,lang:"ru",userName:["Неопознанный жираф","Неопознанный бурундук","Неопознанная квока"].sort((()=>Math.random()-.5))[0]},this.SETTINGS_VOLUME=document.querySelector(".settings__item-volume-value"),this.SETTINGS_TIME=document.querySelector(".settings__item-time-value"),this.SETTINGS_LANG=document.querySelector(".settings__item-lang-value"),this.CONGRATUATION_USERNAME=document.querySelector(".congratulation__username"),this.quiz={completed:[]},this.settingsDefaultSet(),this.artistIndex=10,this.pictureIndex=130,this.answerIndex=0,this.answerValue=null,this.answers=[],this.time=0,this.timerId=null,this.isWaitKey=!1,this.backendUrl="https://art-quiz-by-inord777.herokuapp.com",window.addEventListener("beforeunload",this.setLocalStorage.bind(this)),window.addEventListener("load",this.getLocalStorage.bind(this)),this.MAIN=document.querySelector(".main"),this.MAIN_ARTIST=document.querySelector(".menu__artist"),this.MAIN_PICTURE=document.querySelector(".menu__picture"),this.MAIN_SETTINGS=document.querySelector(".main__settings"),this.MAIN_TOP10=document.querySelector(".main__top10"),this.SETTINGS=document.querySelector(".settings"),this.SETTINGS_BACK=document.querySelector(".settings__back"),this.SETTINGS_DEFAULT=document.querySelector(".settings__default"),this.TOP10=document.querySelector(".top10"),this.TOP10_BACK=document.querySelector(".top10__back"),this.TOP10_TABLE=document.querySelector(".top10__table"),this.SETTINGS_ICO_VOLUME=document.querySelector(".settings__item-volume-ico"),this.SETTINGS_ICO_TIME=document.querySelector(".settings__item-time-ico"),this.SETTINGS_ICO_LANG=document.querySelector(".settings__item-lang-ico"),this.CATALOG=document.querySelector(".catalog"),this.CATALOG_HOME=document.querySelector(".catalog__home"),this.CATALOG_RESULTS=document.querySelectorAll(".catalog_result"),this.CATALOG_RESET=document.querySelector(".catalog__reset"),this.CATALOG_ITEMS=this.CATALOG.querySelectorAll(".catalog__item"),this.QUIZ=document.querySelector(".quiz"),this.QUIZ_ITEMS=document.querySelector(".quiz__items"),this.QUIZ_PICTURES=document.querySelector(".quiz__pictures"),this.QUIZ_BULLETS=document.querySelectorAll(".quiz__bullet"),this.QUIZ_QUESTION=document.querySelector(".quiz__question span"),this.QUIZ_BACK=document.querySelector(".quiz__back"),this.QUIZ_TIME_LOST=document.querySelector(".quiz__time-lost"),this.RESULT=document.querySelector(".result"),this.RESULT_ITEMS=document.querySelectorAll(".result__item"),this.RESULT_SCOPE=document.querySelector(".result__scope"),this.RESULT_TITLE_NUMBER=document.querySelector(".result__title-number"),this.RESULT_BACK=document.querySelector(".result__back"),this.ANSWER=document.querySelector(".answer"),this.ANSWER_PIC=this.ANSWER.querySelector(".answer__pic"),this.ANSWER_NAME=this.ANSWER.querySelector(".answer__name"),this.ANSWER_AUTHOR=this.ANSWER.querySelector(".answer__author"),this.ANSWER_YEAR=this.ANSWER.querySelector(".answer__year"),this.ANSWER_NEXT=document.querySelector(".answer__next"),this.CONGRATUATION=document.querySelector(".congratulation"),this.CONGRATUATION_RESULT=document.querySelector(".congratulation__result .congratulation_text"),this.CONGRATUATION_OK=document.querySelector(".congratulation__ok"),this.CONGRATUATION_SEND=document.querySelector(".congratulation__send"),this.loadImages(),this.MAIN_SETTINGS.addEventListener("click",this.toggleMainSettings.bind(this)),this.MAIN_TOP10.addEventListener("click",this.toggleMainTop10.bind(this)),this.TOP10_BACK.addEventListener("click",this.toggleTop10Main.bind(this)),this.SETTINGS_BACK.addEventListener("click",this.toggleSettingsMain.bind(this)),this.SETTINGS_DEFAULT.addEventListener("click",this.settingsDefaultSet.bind(this)),this.SETTINGS_VOLUME.addEventListener("change",this.settingsVolumeSet.bind(this)),this.SETTINGS_TIME.addEventListener("change",this.settingsTimeSet.bind(this)),this.SETTINGS_LANG.addEventListener("change",this.settingsLangSet.bind(this)),this.SETTINGS_ICO_VOLUME.addEventListener("click",this.toggleVolume.bind(this)),this.SETTINGS_ICO_TIME.addEventListener("click",this.toggleTime.bind(this)),this.SETTINGS_ICO_LANG.addEventListener("click",this.toogleLang.bind(this)),this.QUIZ_BACK.addEventListener("click",this.toogleQuizCatalog.bind(this)),this.CATALOG_HOME.addEventListener("click",this.toggleCatalogMain.bind(this)),[...this.CATALOG_RESULTS].forEach((t=>{t.addEventListener("click",this.toggleCatalogResult.bind(this))})),this.CATALOG_RESET.addEventListener("click",this.resetCatalog.bind(this)),[...this.CATALOG_ITEMS].forEach((t=>{t.addEventListener("click",this.toogleCatalogQuiz.bind(this))})),[...this.RESULT_ITEMS].forEach((t=>{t.addEventListener("click",this.aboutShow.bind(this))})),this.RESULT_BACK.addEventListener("click",this.toggleResultCatalog.bind(this)),this.ANSWER_NEXT.addEventListener("click",this.answerHide.bind(this)),this.CONGRATUATION_OK.addEventListener("click",this.quizEnd.bind(this)),this.CONGRATUATION_SEND.addEventListener("click",this.quizSend.bind(this)),document.addEventListener("keydown",this.keyDown.bind(this))}async loadImages(){let t=await fetch("./assets/json/images.json");t.ok?(this.images=await t.json(),this.MAIN_ARTIST.addEventListener("click",this.toggleMainCatalog.bind(this,this.artistIndex)),this.MAIN_PICTURE.addEventListener("click",this.toggleMainCatalog.bind(this,this.pictureIndex))):alert(a[this.quiz.lang].loadError.replace("{error}",t.status))}async loadTop10(){for(let t=0;t<10;t++)this.TOP10_TABLE.children[t+1].children[1].textContent="",this.TOP10_TABLE.children[t+1].children[2].textContent="";let t=await fetch("/top10");if(t.ok){const e=await t.json();for(let t=0;t<e.length;t++)this.TOP10_TABLE.children[t+1].children[1].textContent=e[t].username,this.TOP10_TABLE.children[t+1].children[2].textContent=e[t].total}}keyDown(t){if(this.isWaitKey&&["1","2","3","4"].includes(t.key)){this.timerStop();let e=this.catalogStartIndex();this.toogleAnswer(this.answerValue==[...document.querySelectorAll(this.isArtist(e)?".quiz__item":".quiz__picture-pictures")][Number(t.key)-1].dataset.answer,Number(this.QUIZ.dataset.picNumber),!0),this.ANSWER.classList.add("popup-visible"),this.ANSWER.classList.remove("popup-hidden")}}setLocalStorage(){localStorage.setItem("quiz",JSON.stringify(this.quiz))}getLocalStorage(){localStorage.getItem("quiz")&&(this.quiz=JSON.parse(localStorage.getItem("quiz")),this.settingsSet()),"ru"!=this.quiz.lang&&this.translateApp()}toggleMainSettings(){n(this.MAIN,this.SETTINGS)}toggleSettingsMain(){n(this.SETTINGS,this.MAIN)}toggleMainTop10(){this.loadTop10(),n(this.MAIN,this.TOP10)}toggleTop10Main(){n(this.TOP10,this.MAIN)}settingsSet(){this.SETTINGS_VOLUME.value=this.quiz.volume,this.SETTINGS_TIME.value=this.quiz.time,this.SETTINGS_LANG.value=this.quiz.lang,this.CONGRATUATION_USERNAME.value=this.quiz.userName}settingsDefaultSet(){[this.quiz.volume,this.quiz.time,this.quiz.lang,this.quiz.userName]=Object.values(this.settingsDefault),this.settingsSet(),this.translateApp()}settingsVolumeSet(){this.quiz.volume=Number(this.SETTINGS_VOLUME.value)}settingsTimeSet(){this.quiz.time=Number(this.SETTINGS_TIME.value)}settingsLangSet(){this.quiz.lang=this.SETTINGS_LANG.value,this.translateApp()}toggleVolume(){this.SETTINGS_VOLUME.value=0==this.SETTINGS_VOLUME.value?.5:0,this.settingsVolumeSet()}toggleTime(){this.SETTINGS_TIME.value=0==this.SETTINGS_TIME.value?30:0,this.settingsTimeSet()}toogleLang(){this.SETTINGS_LANG.value="ru"==this.SETTINGS_LANG.value?"en":"ru",this.settingsLangSet()}translateApp(){for(const[t,e]of Object.entries(a[this.quiz.lang].gui))[...document.querySelectorAll(t)].forEach((t=>{t.textContent=e}));this.CONGRATUATION_USERNAME.placeholder=a[this.quiz.lang].username}shuffleAnswer(t,e){const i=[t];for(;i.length<4;){const t=this.images.filter((t=>!i.includes(t[e])));i.push(t[this.getRandomInt(0,t.length)][e])}return i.sort((()=>Math.random()-.5))}getRandomInt(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t))+t}clearNode(t){for(;t.firstChild;)t.removeChild(t.firstChild)}timerStop(){this.timerId=null}toogleQuizCatalog(){this.timerStop(),this.isWaitKey=!1,n(this.QUIZ,this.CATALOG)}async quizUpdate(t){this.timeSet("--"),this.QUIZ.dataset.picNumber=t,this.clearNode(this.QUIZ_PICTURES),this.clearNode(this.QUIZ_ITEMS);const e=this.images.filter((e=>e.imageNum==t))[0];if(this.isArtist(t)){const i="author";this.answerValue=e[i];const s=this.shuffleAnswer(this.answerValue,i);this.QUIZ_QUESTION.textContent=a[this.quiz.lang].artistsQuestion,this.QUIZ_PICTURES.className="quiz__pictures";const n=document.createElement("div");n.className="quiz__picture quiz__picture-artists",n.textContent=a[this.quiz.lang].loading,this.QUIZ_PICTURES.append(n),n.style.backgroundImage=await this.loadBackgroundImage(`./assets/img/${t}.jpg`),n.textContent="";for(let t=0;t<4;t++){const e=document.createElement("div");e.className="quiz__item",e.dataset.answer=s[t],e.textContent=`${t+1}. ${e.dataset.answer}`,e.addEventListener("click",this.answerShow.bind(this)),this.QUIZ_ITEMS.append(e)}}else{const t="imageNum";this.answerValue=e[t];const i=this.shuffleAnswer(this.answerValue,t);this.QUIZ_QUESTION.textContent=a[this.quiz.lang].picturesQuestion.replace("{author}",e.author),this.QUIZ_PICTURES.className="quiz__pictures quiz_pictures-grid";for(let t=0;t<4;t++){const e=document.createElement("div");e.className="quiz__picture quiz__picture-pictures",e.dataset.answer=i[t],e.textContent=a[this.quiz.lang].loading,e.dataset.tooltip=t+1,this.QUIZ_PICTURES.append(e)}const s=[];for(let t=0;t<4;t++)s.push(await this.loadBackgroundImage(`./assets/img/${i[t]}.jpg`)),this.QUIZ_PICTURES.children[t].textContent="";for(let t=0;t<4;t++){const e=this.QUIZ_PICTURES.children[t];e.style.backgroundImage=s[t],e.addEventListener("click",this.answerShow.bind(this))}}this.isWaitKey=!0,this.quiz.time>0?(this.time=this.quiz.time,this.timeSet(this.time),this.timerId=setTimeout(this.quizTick.bind(this),1500)):this.timerStop()}timeSet(t){this.QUIZ_TIME_LOST.textContent=t}quizTick(){this.timerId&&(this.time--,this.timeSet(this.time),this.time>0?this.timerId=setTimeout(this.quizTick.bind(this),1e3):(this.timerId=null,this.toogleAnswer(!1,Number(this.QUIZ.dataset.picNumber),!0),this.ANSWER.classList.add("popup-visible"),this.ANSWER.classList.remove("popup-hidden")))}toogleCatalogQuiz(t){let e=this.catalogPicNumber(t);this.quizUpdate(e),Array.from(this.QUIZ_BULLETS).forEach((t=>{t.classList.contains("quiz__bullet-right")&&t.classList.remove("quiz__bullet-right"),t.classList.contains("quiz__bullet-wrong")&&t.classList.remove("quiz__bullet-wrong")})),this.answerIndex=0,this.answers=[],n(this.CATALOG,this.QUIZ)}updateCatalog(t,e=!1){Array.from(this.CATALOG_ITEMS).forEach((i=>{const s=this.quiz.completed.filter((e=>e>=t-9&&e<=t));i.dataset.complete=s.length;const n=i.querySelector(".catalog__item-scope");s.length?n.textContent=s.length+"/10":n.textContent="",e&&(i.querySelector(".catalog__item-pic").style.backgroundImage=`url('./assets/img/${t}.jpg')`),t+=10}))}toggleMainCatalog(t){this.CATALOG.querySelector(".catalog__title span").textContent=this.isArtist(t)?a[this.quiz.lang].artists:a[this.quiz.lang].pictures,this.updateCatalog(t,!0),this.CATALOG.dataset.startIndex=t,n(this.MAIN,this.CATALOG)}catalogStartIndex(){return Number(this.CATALOG.dataset.startIndex)}catalogPicNumber(t){let e=this.catalogStartIndex();const i=t.target.parentNode;let s=[...i.parentNode.children].indexOf(i);return this.RESULT_TITLE_NUMBER.textContent=i.querySelector(".catalog__item-title").textContent,this.RESULT_SCOPE.textContent=i.querySelector(".catalog__item-scope").textContent,e-10+10*s+1}isArtist(t){return t<=this.pictureIndex-10}resetCatalog(){let t=this.catalogStartIndex();this.isArtist(t)?this.quiz.completed=this.quiz.completed.filter((t=>t>this.pictureIndex-10)):this.quiz.completed=this.quiz.completed.filter((t=>t<=this.pictureIndex-10)),this.updateCatalog(t)}toggleCatalogMain(){n(this.CATALOG,this.MAIN)}toggleCatalogResult(t){t.stopPropagation();let e=this.catalogPicNumber(t);Array.from(this.RESULT_ITEMS).forEach((t=>{const i=this.quiz.completed.includes(e);t.dataset.complete=i?1:0,t.dataset.picNumber=e,t.querySelector(".result__item-pic").style.backgroundImage=`url('./assets/img/${e}.jpg')`,e++})),n(this.CATALOG,this.RESULT)}toggleResultCatalog(){n(this.RESULT,this.CATALOG)}toogleAnswer(t,e,i){this.isWaitKey=!1,this.ANSWER.dataset.complete=t,"boolean"==typeof t&&this.audioPlay(t?audioRight:audioWrong),this.ANSWER_PIC.style.backgroundImage=`url('./assets/img/${e}.jpg')`;const s=this.images.filter((t=>t.imageNum==e));s.length&&(this.ANSWER_NAME.textContent=s[0].name,this.ANSWER_AUTHOR.textContent=s[0].author,this.ANSWER_YEAR.textContent=s[0].year,this.ANSWER.dataset.isAnswer=i,this.ANSWER.classList.add("popup-visible"),this.ANSWER.classList.remove("popup-hidden"))}answerShow(t){this.timerStop(),this.toogleAnswer(this.answerValue==t.target.dataset.answer,Number(this.QUIZ.dataset.picNumber),!0),this.ANSWER.classList.add("popup-visible"),this.ANSWER.classList.remove("popup-hidden")}aboutShow(t){const e=t.currentTarget,i=e.dataset.complete,s=e.dataset.picNumber;this.toogleAnswer(i,s,!1)}answerHide(){if(this.ANSWER.classList.add("popup-hidden"),this.ANSWER.classList.remove("popup-visible"),"true"==this.ANSWER.dataset.isAnswer){const t="true"===this.ANSWER.dataset.complete;let e,i=Number(this.QUIZ.dataset.picNumber);t?(e="quiz__bullet-right",this.answers.push(i)):e="quiz__bullet-wrong",this.QUIZ_BULLETS[this.answerIndex].classList.add(e),this.answerIndex++,10==this.answerIndex?(this.CONGRATUATION_RESULT.textContent=this.answers.length+"/10",this.quiz.completed=[...new Set([...this.quiz.completed,...this.answers])],this.CONGRATUATION.classList.add("popup-visible"),this.CONGRATUATION.classList.remove("popup-hidden"),this.audioPlay(audioEndRound)):this.quizUpdate(++i)}}audioPlay(t){Number(this.SETTINGS_VOLUME.value)>0&&t.play()}quizSend(){const t={username:this.quiz.userName,total:this.quiz.completed.length};fetch("/add",{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}}),this.quizEnd()}quizEnd(){const t=Number(this.CATALOG.dataset.startIndex);this.updateCatalog(t),this.CONGRATUATION.classList.add("popup-hidden"),this.CONGRATUATION.classList.remove("popup-visible"),n(this.QUIZ,this.CATALOG)}loadBackgroundImage(t){return new Promise(((e,i)=>{let s=new Image;s.src=t,s.onload=()=>{e(`url(${t})`)},s.onerror=()=>{i()}}))}},console.log('Самопроверка 245: \n1. Стартовая страница и навигация +20\n- На стартовой странице есть кнопка: угадать художника, угадать картину, настройки и ТОП 10 (Дополнительный функционал).\n- Реализована навигация по страницам приложения с анимацией.\n2. Настройки +40\n- в настройках есть возможность включать/выключать звук кликом по картинке и есть регулятор громкости звука.\nЕсли звук включён, есть звуковая индикация разная для правильных и неправильных ответов, звуковое сопровождение окончания раунда.\n- в настройках можно указать время для ответа на вопрос в интервале от 0 до 30 секунд с шагом в 5 секунд. Если время истекает, а ответа нет, это засчитывается как неправильный ответ на вопрос +10\n- в настройках есть возможность включать/выключать игру на время - кликом по картинке или установкой интервала времени в 0.\n- при перезагрузке страницы приложения выбранные настройки сохраняются в localStorage.\n3. Страница категорий +30\n- на странице категорий размещаются карточки категорий.\n- карточка сыгранной категории внешне отличается от карточки категории, которая ещё не игралась цветом картинки.\n- на карточке сыгранной категории отображается результат прохождения раунда - количество вопросов, на которые был дан правильный ответ\n4. Страница с вопросами +50\n- вопросы генерируются средствами JavaScript на основе исходных данных.\n- варианты ответов на вопросы генерируются случайным образом\n- правильным и неправильным ответам пользователя соответствуют индикаторы разного цвета\n- после того, как ответ выбран, появляется модальное окно с правильным ответом на вопрос и кнопкой "Продолжить"\n- после окончания раунда выводится уведомление об окончании раунда и его результат - количество вопросов, на которые был дан правильный ответ. Есть возможность поделиться своим результатом. (Дополнительный функционал).\n5. Страница с результатами +50\n- выполняются требования к вёрстке и оформлению приложения\n- страница с результатами содержит превью всех картин категории\n- картины, на вопросы про которые или про их авторов был дан правильный ответ, цветные; картины, на вопросы про которые или про их авторов был дан неправильный ответ, черно-белые\n- при клике по картине выводится информация о ней - название, автор, год создания\n- сли раунд переигрывался, и результаты изменились, эти изменения отображаются на странице с результатами\n6. Плавная смена изображений; картинки сначала загружаются, потом отображаются; нет ситуации, когда пользователь видит частично загрузившиеся изображения. +10\n7. Реализована анимация отдельных деталей интерфейса +20\n- анимация при навигации по страницам +5 \n- анимация при наведении курсора на кнопку Настройки. +5\n- анимация при всплытии правильного ответа +5\n- анимация при всплытии правильного ответа +5\n- анимация при наведении курсора на картинку категории и кнопку Результаты +5\nДополнительный функционал на выбор +20\n- перевод приложения на два языка +5\n- управление игрой с клавиатуры +5\n- создание небольшого бэкенда для хранения результатов викторины (можно посмотреть и сравнить свои результаты и результаты других пользователей) +10. Результаты других пользователей можно посмотреть по кнопке ТОП 10 на главной странице. Сохранить результаты в базу данных можно после окончания раунда по кнопке Поделиться, предварительно можно указать своё имя.\n- предусмотрен запуск обратного отсчета викторины только после загрузки всех изображений, что актуально для медленных соединений. Загрузка изображений выполняется последовательно с отображением теста Загрузка.... После загрузки текущего изображения текст исчезает. После загрузки последнего изображения начинается обратный отсчет. +5\n')})();